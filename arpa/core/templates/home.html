{% extends "master.html" %}
{% load humanize %}
{% load static %}

{% block title %}A R P A{% endblock %}
{% block navbar_title %}Dashboard{% endblock %}

{% block navbar_buttons %}
<a href="{% url 'person_list' %}" class="btn btn-custom-primary" title="Personas">
    <i class="fas fa-users"></i>
</a>
<!--<a href="{% url 'financial_report_list' %}" class="btn btn-custom-primary" title="Bienes y Rentas">
    <i class="fas fa-chart-line"></i>
</a>-->
<a href="{% url 'tcs_list' %}" class="btn btn-custom-primary" title="Tarjetas">
    <i class="far fa-credit-card"></i>
</a>
<!--<a href="{% url 'conflict_list' %}" class="btn btn-custom-primary" title="Conflictos">
    <i class="fas fa-balance-scale"></i>
</a>-->
<a href="{% url 'alerts_list' %}" class="btn btn-custom-primary" title="Alertas">
    <i class="fas fa-bell"></i>
</a>
<a href="{% url 'import' %}" class="btn btn-custom-primary" title="Importar">
    <i class="fas fa-database"></i>
</a>
<form method="post" action="{% url 'logout' %}" class="d-inline">
    {% csrf_token %}
    <button type="submit" class="btn btn-custom-primary" title="Cerrar sesion">
        <i class="fas fa-sign-out-alt"></i>
    </button>
</form>
{% endblock %}

{% block content %}
<div class="row g-4">
    <div class="col-md-3">
        <a href="{% url 'person_list' %}" class="card h-100 shadow-sm border-0 text-decoration-none">
            <div class="card-body text-center p-4">
                <i class="fas fa-users fa-3x text-primary mb-3"></i>
                <h5 class="card-title fw-normal mb-1">Total de Personas</h5>
                <h2 class="card-text fw-bold text-dark">{{ person_count|intcomma }}</h2>
            </div>
        </a>
    </div>
    <!--
    <div class="col-md-3">
        <a href="{% url 'conflict_list' %}" class="card h-100 shadow-sm border-0 text-decoration-none">
            <div class="card-body text-center p-4">
                <i class="fas fa-balance-scale fa-3x text-warning mb-3"></i>
                <h5 class="card-title fw-normal mb-1">Declaraciones de Conflictos</h5>
                <h2 class="card-text fw-bold text-dark">{{ conflict_count|intcomma }}</h2>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{% url 'financial_report_list' %}" class="card h-100 shadow-sm border-0 text-decoration-none">
            <div class="card-body text-center p-4">
                <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
                <h5 class="card-title fw-normal mb-1">Declaraciones B&R</h5>
                <h2 class="card-text fw-bold text-dark">{{ finances_count|intcomma }}</h2>
            </div>
        </a>
    </div>
    -->
    <div class="col-md-3">
        <a href="{% url 'tcs_list' %}" class="card h-100 shadow-sm border-0 text-decoration-none">
            <div class="card-body text-center p-4">
                <i class="far fa-credit-card fa-3x text-info mb-3"></i>
                <h5 class="card-title fw-normal mb-1">Transacciones TC</h5>
                <h2 class="card-text fw-bold text-dark">{{ tc_count|intcomma }}</h2>
            </div>
        </a>
    </div>
    <!--
    <div class="col-md-3">
        <a href="{% url 'person_list' %}?status=Activo" class="card h-100 shadow-sm border-0 text-decoration-none">
            <div class="card-body text-center p-4">
                <i class="fas fa-running fa-3x text-success mb-3"></i>
                <h5 class="card-title fw-normal mb-1">Personas Activas</h5>
                <h2 class="card-text fw-bold text-dark">{{ active_person_count|intcomma }}</h2>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{% url 'person_list' %}?status=Retirado" class="card h-100 shadow-sm border-0 text-decoration-none">
            <div class="card-body text-center p-4">
                <i class="fas fa-user-times fa-3x text-secondary mb-3"></i>
                <h5 class="card-title fw-normal mb-1">Personas Retiradas</h5>
                <h2 class="card-text fw-bold text-dark">{{ retired_person_count|intcomma }}</h2>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a href="{% url 'conflict_list' %}?column=q3&answer=yes" class="card h-100 shadow-sm border-0 text-decoration-none">
            <div class="card-body text-center p-4">
                <i class="fas fa-handshake fa-3x text-warning mb-3"></i>
                <h5 class="card-title fw-normal mb-1">Accionista del Grupo</h5>
                <h2 class="card-text fw-bold text-dark">{{ accionista_grupo_count|intcomma }}</h2> 
            </div>
        </a>
    </div>
    -->
    <div class="col-md-3">
        <a href="{% url 'alerts_list' %}" class="card h-100 shadow-sm border-0 text-decoration-none">
            <div class="card-body text-center p-4">
                <i class="fas fa-bell fa-3x text-danger mb-3"></i>
                <h5 class="card-title fw-normal mb-1">Alertas</h5>
                <h2 class="card-text fw-bold text-dark">{{ alerts_count|intcomma }}</h2>
            </div>
        </a>
    </div>
</div>

<div class="row my-4 g-4">
    <div class="col-12 col-lg-6">
        <div class="card p-3 shadow-sm h-100">
            <h5 class="card-title text-center fw-bold">Declaraciones de Conflictos Anual</h5>
            <canvas id="conflictsChart"></canvas>
        </div>
    </div>
    <div class="col-12 col-lg-6">
        <div class="card p-3 shadow-sm h-100">
            <h5 class="card-title text-center fw-bold">Declaraciones B&R Anual</h5>
            <canvas id="declarationsChart"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const declarationsCtx = document.getElementById('declarationsChart').getContext('2d');
        const declarationsChart = new Chart(declarationsCtx, {
            type: 'bar',
            data: {
                labels: ['2021', '2022', '2023', '2024'],
                datasets: [{
                    label: 'NUmero de Declaraciones',
                    data: [
                        "{{ declarations_2021_count|default:0 }}",
                        "{{ declarations_2022_count|default:0 }}",
                        "{{ declarations_2023_count|default:0 }}",
                        "{{ declarations_2024_count|default:0 }}"
                    ],
                    backgroundColor: [
                        '#003366',
                        '#005588',
                        '#0077AA',
                        '#0099CC'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Cantidad'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Anual'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });

        const conflictsCtx = document.getElementById('conflictsChart').getContext('2d');
        const conflictsChart = new Chart(conflictsCtx, {
            type: 'bar',
            data: {
                labels: ['2021', '2022', '2023', '2024'],
                datasets: [{
                    label: 'NUmero de Declaraciones',
                    data: [
                        "{{ conflicts_2021_count|default:0 }}",
                        "{{ conflicts_2022_count|default:0 }}",
                        "{{ conflicts_2023_count|default:0 }}",
                        "{{ conflicts_2024_count|default:0 }}"
                    ],
                    backgroundColor: [
                        '#FF8C00',
                        '#FFA500',
                        '#FFB732',
                        '#FFC966'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Cantidad'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Anual'
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    });
</script>
{% endblock %}
